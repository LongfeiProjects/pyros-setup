macro(catkin_python_venv_install_requirements)

	set( installed_packages_file
	  "@TubeTK_BINARY_DIR@/CMakeFiles/CMakeTmp/InstalledVirtualEnvPackages.txt" )
	if( NOT EXISTS ${installed_packages_file} )
	  file( WRITE ${installed_packages_file} "" )
	endif( NOT EXISTS ${installed_packages_file} )
	file( READ ${installed_packages_file} installed_packages )

	foreach( package @PYTHON_TESTING_MODULES@ )
	  string( FIND "${installed_packages}" ${package} package_installed )
	  if( ${package_installed} EQUAL -1 )
		message( STATUS "Installing requirements into virtualenv" )
		execute_process( COMMAND "@PythonVirtualenvHome@/bin/pip"
		    install ${package}
		  RESULT_VARIABLE failed
		  ERROR_VARIABLE error )
		if( failed )
		  message( ERROR ${error} )
		else( failed )
		  file( APPEND ${installed_packages_file} "${package}\n" )
		endif( failed )
	  endif( ${package_installed} EQUAL -1 )
	endforeach()

endmacro(catkin_python_venv_install_requirements)
